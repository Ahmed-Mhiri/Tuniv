<div class="page-container-reddit">
  <div class="content-col">
    @if (isLoading()) {
      <div class="status-container">
        <app-spinner></app-spinner>
      </div>
    } @else if (question(); as q) {
      
      @if (isEditing()) {
        <div class="question-container">
          <app-post-edit-form
            [initialTitle]="q.title"
            [initialBody]="q.body"
            [initialAttachments]="q.attachments"
            postType="Question"
            (save)="handleSave($event)"
            (cancel)="isEditing.set(false)"
          ></app-post-edit-form>
        </div>

      } @else {
        <div class="question-container">
          <div class="question-header">
            <div>
              <h1 nz-typography class="question-title">{{ q.title }}</h1>
              <div class="meta-info">
                <span>Asked {{ q.createdAt | timeAgo }} by </span>
                <a [routerLink]="['/users', q.author.userId]" class="author-link">{{ q.author.username }}</a>
              </div>
            </div>

            @if (isCurrentUserQuestionAuthor()) {
              <div class="header-actions">
                <button nz-button nzType="text" class="action-button" (click)="isEditing.set(true)">
                  <span nz-icon nzType="edit"></span> Edit
                </button>
                <button nz-button nzType="text" nzDanger class="action-button" (click)="deleteQuestion()">
                  <span nz-icon nzType="delete"></span> Delete
                </button>
              </div>
            }
          </div>
          <nz-divider></nz-divider>
          <div class="question-body-wrapper">
            <div class="vote-container">
              <app-vote
                [score]="q.score"
                [userVote]="q.currentUserVote"
                (vote)="handleQuestionVote($event)"
              ></app-vote>
            </div>
            <div class="content-container prose dark:prose-invert max-w-none" [innerHTML]="q.body"></div>
          </div>
        </div>

        @if (q.attachments && q.attachments.length > 0) {
          <div class="attachments-section">
            <h4 class="attachments-title">Attachments</h4>
            <div class="attachments-list">
              @for (att of q.attachments; track att.fileUrl) {
                <a class="attachment-item" [href]="att.fileUrl" target="_blank" [title]="att.fileName">
                  @if (att.fileType.startsWith('image/')) {
                    <img [src]="att.fileUrl" alt="{{ att.fileName }}" class="img-preview" />
                  } @else {
                    <span nz-icon nzType="file-text" class="file-icon"></span>
                    <span class="file-name">{{ att.fileName }}</span>
                  }
                </a>
              }
            </div>
          </div>
        }
      }
      <nz-divider></nz-divider>

      <div class="answers-container">
        @if (authService.isUserLoggedIn()) {
          <app-answer-form (answerSubmit)="handleAnswerSubmit($event)"></app-answer-form>
        }
        
        <div class="answers-section">
          <h2 nz-typography class="answers-title">{{ q.answers.length }} Answers</h2>
          @for (answer of q.answers; track answer.answerId) {
            <app-answer-item
              [answer]="answer"
              [isQuestionAuthor]="isCurrentUserQuestionAuthor()"
              (updateRequired)="refreshData()"
            ></app-answer-item>
          } @empty {
            <div class="py-8">
              @if(!authService.isUserLoggedIn()){
                <nz-alert
                  nzType="info"
                  nzMessage="You must be logged in to post an answer."
                  [nzAction]="loginAction"
                  nzShowIcon
                ></nz-alert>
                <ng-template #loginAction>
                  <a routerLink="/login" nz-button nzType="primary" nzSize="small">Login</a>
                </ng-template>
              } @else {
                <nz-empty nzNotFoundContent="No answers yet. Be the first to help!"></nz-empty>
              }
            </div>
          }
        </div>
      </div>
    } @else {
      <div class="status-container">
          <nz-empty nzNotFoundContent="Question not found or you do not have permission to view it."></nz-empty>
      </div>
    }
  </div>

  <div class="sidebar-col">
    <div class="sidebar-widget">
      <h4>About this Module</h4>
      <p>Module-related information, rules, or related questions could go here.</p>
    </div>
  </div>
</div>