@if (isLoading()) {
  <div class="loading-container">
    <app-spinner></app-spinner>
    <p class="loading-text">Loading Your Profile...</p>
  </div>
} @else {
  <div class="edit-profile-container">
    <h3 nz-typography class="form-section-title">Edit Your Profile</h3>
    <p nz-typography nzType="secondary" class="form-section-subtitle">
      Update your profile picture, major, and bio.
    </p>

    <div class="profile-picture-section">
      <div class="avatar-container">
        <nz-avatar [nzSize]="96" nzIcon="user" [nzSrc]="profilePhotoUrl()"></nz-avatar>
        @if (isUploading()) {
          <div class="upload-spinner-overlay">
            <app-spinner></app-spinner>
          </div>
        }
      </div>
      <div class="uploader-container">
        <app-file-upload
          [multiple]="false"
          [maxFileSize]="5"
          uploadText="Click or drag a new photo here"
          uploadHint="PNG, JPG, GIF up to 5MB. Recommended: 1:1 ratio."
          (filesChanged)="onProfilePhotoChanged($event)"
        ></app-file-upload>
      </div>
    </div>
    
    <nz-divider></nz-divider>

    <form nz-form [nzLayout]="'vertical'" [formGroup]="editForm" (ngSubmit)="submitForm()">
      <nz-form-item>
        <nz-form-label nzFor="major">Major</nz-form-label>
        <nz-form-control nzErrorTip="Major cannot exceed 100 characters.">
          <input nz-input formControlName="major" id="major" placeholder="e.g., Computer Science" />
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label nzFor="bio">Bio</nz-form-label>
        <nz-form-control nzErrorTip="Bio cannot exceed 500 characters.">
          <nz-textarea-count [nzMaxCharacterCount]="500">
            <textarea
              nz-input
              formControlName="bio"
              id="bio"
              placeholder="Tell us a little about yourself"
              [nzAutosize]="{ minRows: 4, maxRows: 8 }"
            ></textarea>
          </nz-textarea-count>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-control class="flex justify-end">
          <button nz-button nzType="primary" [nzLoading]="isSaving()" [disabled]="editForm.pristine || editForm.invalid">
            Save Profile Details
          </button>
        </nz-form-control>
      </nz-form-item>
    </form>
  </div>
}